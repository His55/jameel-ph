<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جميل غانم للتصوير الفوتوغرافي | jameel-ph</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Supabase CSS -->
    <link href="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/style.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        .brand-red { background-color: #dc2626; }
        .brand-red-hover:hover { background-color: #b91c1c; }
        .text-brand-red { color: #dc2626; }
        
        .gallery-item {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .admin-panel {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
        }
        
        .modal {
            backdrop-filter: blur(10px);
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            object-fit: cover;
        }
        
        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #dc2626;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .portfolio-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .comment-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        
        .comment {
            background: #f9fafb;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .comment-author {
            font-weight: bold;
            color: #1f2937;
        }
        
        .comment-date {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .comment-actions {
            display: flex;
            gap: 1rem;
        }
        
        .like-button {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: #6b7280;
            cursor: pointer;
        }
        
        .like-button:hover {
            color: #dc2626;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-black text-white shadow-lg fixed w-full top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <h1 class="text-2xl font-bold text-brand-red">جميل غانم</h1>
                    <span class="text-gray-300">مصور فوتوغرافي</span>
                </div>
                <div class="hidden md:flex space-x-6 space-x-reverse">
                    <a href="#home" class="hover:text-brand-red transition-colors">الرئيسية</a>
                    <a href="#portfolio" class="hover:text-brand-red transition-colors">معرض الأعمال</a>
                    <a href="#services" class="hover:text-brand-red transition-colors">الخدمات</a>
                    <a href="#about" class="hover:text-brand-red transition-colors">نبذة عني</a>
                    <a href="#contact" class="hover:text-brand-red transition-colors">التواصل</a>
                    <button onclick="showAdminLogin()" class="bg-brand-red px-4 py-2 rounded hover:bg-red-700 transition-colors">
                        <i class="fas fa-cog ml-2"></i>إدارة الموقع
                    </button>
                </div>
                <button class="md:hidden" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="hidden md:hidden bg-gray-900 px-4 py-4">
            <a href="#home" class="block py-2 hover:text-brand-red">الرئيسية</a>
            <a href="#portfolio" class="block py-2 hover:text-brand-red">معرض الأعمال</a>
            <a href="#services" class="block py-2 hover:text-brand-red">الخدمات</a>
            <a href="#about" class="block py-2 hover:text-brand-red">نبذة عني</a>
            <a href="#contact" class="block py-2 hover:text-brand-red">التواصل</a>
            <button onclick="showAdminLogin()" class="block w-full text-right py-2 text-brand-red">إدارة الموقع</button>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="bg-black text-white pt-20 pb-16">
        <div class="container mx-auto px-4 text-center">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-5xl font-bold mb-6">
                    مرحباً بكم في عالم <span class="text-brand-red">التصوير الاحترافي</span>
                </h2>
                <p class="text-xl mb-8 text-gray-300" id="heroDescription">
                    أسعى لتخليد لحظاتكم الثمينة بأجمل الصور وأروع الذكريات
                </p>
                <div class="flex justify-center space-x-4 space-x-reverse">
                    <a href="https://wa.me/967771145933" class="bg-brand-red px-8 py-3 rounded-lg hover:bg-red-700 transition-colors">
                        <i class="fab fa-whatsapp ml-2"></i>تواصل معي
                    </a>
                    <a href="#portfolio" class="border border-white px-8 py-3 rounded-lg hover:bg-white hover:text-black transition-colors">
                        استعرض أعمالي
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Portfolio Section -->
    <section id="portfolio" class="py-16 bg-white">
        <div class="container mx-auto px-4">
            <h2 class="text-4xl font-bold text-center mb-12 text-black">معرض الأعمال</h2>
            
            <!-- Filter Buttons -->
            <div class="flex justify-center mb-8 flex-wrap gap-4">
                <button onclick="filterPortfolio('all')" class="filter-btn bg-brand-red text-white px-6 py-2 rounded-lg">
                    جميع الأعمال
                </button>
                <button onclick="filterPortfolio('wedding')" class="filter-btn bg-gray-200 text-black px-6 py-2 rounded-lg hover:bg-brand-red hover:text-white">
                    حفلات الزفاف
                </button>
                <button onclick="filterPortfolio('portrait')" class="filter-btn bg-gray-200 text-black px-6 py-2 rounded-lg hover:bg-brand-red hover:text-white">
                    جلسات تصوير
                </button>
                <button onclick="filterPortfolio('event')" class="filter-btn bg-gray-200 text-black px-6 py-2 rounded-lg hover:bg-brand-red hover:text-white">
                    مناسبات
                </button>
                <button onclick="filterPortfolio('product')" class="filter-btn bg-gray-200 text-black px-6 py-2 rounded-lg hover:bg-brand-red hover:text-white">
                    منتجات
                </button>
            </div>
            
            <!-- Loading Indicator -->
            <div id="portfolioLoading" class="text-center py-8">
                <div class="loading mx-auto"></div>
                <p class="mt-4 text-gray-600">جاري تحميل المعرض...</p>
            </div>
            
            <!-- Portfolio Grid -->
            <div id="portfolioGrid" class="portfolio-grid hidden">
                <!-- Portfolio items will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="py-16 bg-gray-100">
        <div class="container mx-auto px-4">
            <h2 class="text-4xl font-bold text-center mb-12 text-black">خدماتي</h2>
            
            <!-- Loading Indicator -->
            <div id="servicesLoading" class="text-center py-8">
                <div class="loading mx-auto"></div>
                <p class="mt-4 text-gray-600">جاري تحميل الخدمات...</p>
            </div>
            
            <div id="servicesGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 hidden">
                <!-- Services will be loaded here -->
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-16 bg-white">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-4xl font-bold mb-8 text-black">نبذة عني</h2>
                <div id="aboutLoading" class="text-center py-8">
                    <div class="loading mx-auto"></div>
                    <p class="mt-4 text-gray-600">جاري التحميل...</p>
                </div>
                <div id="aboutContent" class="text-lg text-gray-700 leading-relaxed hidden">
                    <!-- About content will be loaded here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Articles Section -->
    <section id="articles" class="py-16 bg-gray-100">
        <div class="container mx-auto px-4">
            <h2 class="text-4xl font-bold text-center mb-12 text-black">مقالات ونصائح</h2>
            
            <!-- Loading Indicator -->
            <div id="articlesLoading" class="text-center py-8">
                <div class="loading mx-auto"></div>
                <p class="mt-4 text-gray-600">جاري تحميل المقالات...</p>
            </div>
            
            <div id="articlesGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 hidden">
                <!-- Articles will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="py-16 bg-black text-white">
        <div class="container mx-auto px-4">
            <h2 class="text-4xl font-bold text-center mb-12">تواصل معي</h2>
            <div class="grid md:grid-cols-2 gap-12">
                <div>
                    <h3 class="text-2xl font-bold mb-6 text-brand-red">معلومات التواصل</h3>
                    <div class="space-y-4">
                        <div class="flex items-center">
                            <i class="fas fa-phone text-brand-red ml-4 text-xl"></i>
                            <span id="contactPhone">771145933</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fab fa-whatsapp text-brand-red ml-4 text-xl"></i>
                            <a href="https://wa.me/967771145933" class="hover:text-brand-red">واتساب</a>
                        </div>
                        <div id="socialLinks" class="flex space-x-4 space-x-reverse mt-6">
                            <!-- Social links will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-2xl font-bold mb-6 text-brand-red">أرسل رسالة</h3>
                    <form id="contactForm" class="space-y-4">
                        <input type="text" id="clientName" placeholder="الاسم" class="w-full p-3 rounded bg-gray-800 text-white border border-gray-600 focus:border-brand-red" required>
                        <input type="email" id="clientEmail" placeholder="البريد الإلكتروني" class="w-full p-3 rounded bg-gray-800 text-white border border-gray-600 focus:border-brand-red" required>
                        <input type="tel" id="clientPhone" placeholder="رقم الهاتف" class="w-full p-3 rounded bg-gray-800 text-white border border-gray-600 focus:border-brand-red" required>
                        <textarea id="clientMessage" placeholder="الرسالة" rows="5" class="w-full p-3 rounded bg-gray-800 text-white border border-gray-600 focus:border-brand-red" required></textarea>
                        <button type="submit" class="w-full bg-brand-red py-3 rounded hover:bg-red-700 transition-colors">
                            <span id="contactSubmitText">إرسال الرسالة</span>
                            <div id="contactSubmitLoading" class="loading hidden"></div>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-8">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 هشام الفقيه | 774426179 - جميع الحقوق محفوظة</p>
        </div>
    </footer>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 modal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg p-8 max-w-md w-full">
                <h3 class="text-2xl font-bold mb-6 text-center text-black">دخول المدير</h3>
                <form id="adminLoginForm">
                    <input type="email" id="adminUsername" placeholder="البريد الإلكتروني" class="w-full p-3 mb-4 border rounded" required>
                    <input type="password" id="adminPassword" placeholder="كلمة المرور" class="w-full p-3 mb-6 border rounded" required>
                    <div class="flex space-x-4 space-x-reverse">
                        <button type="submit" class="flex-1 bg-brand-red text-white py-3 rounded hover:bg-red-700">
                            <span id="loginText">دخول</span>
                            <div id="loginLoading" class="loading hidden"></div>
                        </button>
                        <button type="button" onclick="hideAdminLogin()" class="flex-1 bg-gray-300 text-black py-3 rounded hover:bg-gray-400">إلغاء</button>
                    </div>
                    <div class="mt-4 text-center">
                        <a href="#" onclick="showResetPasswordModal()" class="text-brand-red hover:underline text-sm">نسيت كلمة المرور؟</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div id="resetPasswordModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 modal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg p-8 max-w-md w-full">
                <h3 class="text-2xl font-bold mb-6 text-center text-black">استعادة كلمة المرور</h3>
                <form id="resetPasswordForm">
                    <input type="email" id="resetEmail" placeholder="البريد الإلكتروني" class="w-full p-3 mb-6 border rounded" required>
                    <button type="submit" class="w-full bg-brand-red text-white py-3 rounded hover:bg-red-700">إرسال رابط الاستعادة</button>
                    <button type="button" onclick="hideResetPasswordModal()" class="w-full mt-2 bg-gray-300 text-black py-3 rounded hover:bg-gray-400">إلغاء</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="fixed inset-0 bg-gray-900 hidden z-50 admin-panel overflow-y-auto">
        <div class="container mx-auto px-4 py-8">
            <!-- Admin Header -->
            <div class="flex justify-between items-center mb-8 bg-gray-800 p-4 rounded-lg">
                <h2 class="text-2xl font-bold text-white">لوحة التحكم - جميل غانم</h2>
                <button onclick="hideAdminPanel()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                    <i class="fas fa-times ml-2"></i>إغلاق
                </button>
            </div>

            <!-- Admin Navigation -->
            <div class="flex flex-wrap gap-4 mb-8">
                <button onclick="showAdminSection('portfolio')" class="admin-nav-btn bg-brand-red text-white px-6 py-3 rounded">
                    <i class="fas fa-images ml-2"></i>إدارة المعرض
                </button>
                <button onclick="showAdminSection('services')" class="admin-nav-btn bg-gray-600 text-white px-6 py-3 rounded">
                    <i class="fas fa-briefcase ml-2"></i>إدارة الخدمات
                </button>
                <button onclick="showAdminSection('about')" class="admin-nav-btn bg-gray-600 text-white px-6 py-3 rounded">
                    <i class="fas fa-user ml-2"></i>السيرة الذاتية
                </button>
                <button onclick="showAdminSection('articles')" class="admin-nav-btn bg-gray-600 text-white px-6 py-3 rounded">
                    <i class="fas fa-newspaper ml-2"></i>المقالات
                </button>
                <button onclick="showAdminSection('settings')" class="admin-nav-btn bg-gray-600 text-white px-6 py-3 rounded">
                    <i class="fas fa-cog ml-2"></i>الإعدادات
                </button>
                <button onclick="showAdminSection('messages')" class="admin-nav-btn bg-gray-600 text-white px-6 py-3 rounded">
                    <i class="fas fa-envelope ml-2"></i>الرسائل
                </button>
                <button onclick="showAdminSection('comments')" class="admin-nav-btn bg-gray-600 text-white px-6 py-3 rounded">
                    <i class="fas fa-comments ml-2"></i>التعليقات
                </button>
                <button onclick="showAdminSection('account')" class="admin-nav-btn bg-gray-600 text-white px-6 py-3 rounded">
                    <i class="fas fa-key ml-2"></i>إدارة الحساب
                </button>
            </div>

            <!-- Admin Sections -->
            <div id="adminContent" class="bg-gray-800 rounded-lg p-6">
                <!-- Portfolio Management -->
                <div id="adminPortfolio" class="admin-section">
                    <h3 class="text-xl font-bold text-white mb-6">إدارة معرض الأعمال</h3>
                    
                    <!-- Add New Image Form -->
                    <div class="bg-gray-700 p-6 rounded-lg mb-6">
                        <h4 class="text-lg font-bold text-white mb-4">إضافة صورة جديدة</h4>
                        <form id="addImageForm" class="space-y-4">
                            <input type="text" id="imageTitle" placeholder="عنوان الصورة" class="w-full p-3 rounded bg-gray-600 text-white" required>
                            <select id="imageCategory" class="w-full p-3 rounded bg-gray-600 text-white" required>
                                <option value="">اختر الفئة</option>
                                <option value="wedding">حفلات الزفاف</option>
                                <option value="portrait">جلسات تصوير</option>
                                <option value="event">مناسبات</option>
                                <option value="product">منتجات</option>
                            </select>
                            <textarea id="imageDescription" placeholder="وصف الصورة" class="w-full p-3 rounded bg-gray-600 text-white" rows="3" required></textarea>
                            <input type="file" id="imageFile" accept="image/*" class="w-full p-3 rounded bg-gray-600 text-white" required>
                            <div id="imagePreview" class="hidden">
                                <img id="previewImg" class="image-preview rounded">
                            </div>
                            <button type="submit" class="bg-brand-red text-white px-6 py-3 rounded hover:bg-red-700">
                                <span id="addImageText"><i class="fas fa-plus ml-2"></i>إضافة الصورة</span>
                                <div id="addImageLoading" class="loading hidden"></div>
                            </button>
                        </form>
                    </div>
                    
                    <!-- Existing Images -->
                    <div id="adminPortfolioList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Portfolio items will be loaded here -->
                    </div>
                </div>

                <!-- Comments Management -->
                <div id="adminComments" class="admin-section hidden">
                    <h3 class="text-xl font-bold text-white mb-6">إدارة التعليقات</h3>
                    <div id="adminCommentsList" class="space-y-4">
                        <!-- Comments will be loaded here -->
                    </div>
                </div>

                <!-- Other admin sections... -->
            </div>
        </div>
    </div>

    <!-- Comment Modal -->
    <div id="commentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 modal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg p-6 max-w-md w-full">
                <h3 class="text-xl font-bold mb-4">إضافة تعليق</h3>
                <form id="commentForm">
                    <input type="text" id="commentName" placeholder="الاسم" class="w-full p-3 mb-3 border rounded" required>
                    <input type="email" id="commentEmail" placeholder="البريد الإلكتروني" class="w-full p-3 mb-3 border rounded" required>
                    <textarea id="commentText" placeholder="التعليق" class="w-full p-3 mb-3 border rounded" rows="4" required></textarea>
                    <button type="submit" class="w-full bg-brand-red text-white py-2 rounded">إرسال</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Image Lightbox -->
    <div id="lightbox" class="fixed inset-0 bg-black bg-opacity-90 hidden z-50 flex items-center justify-center">
        <div class="relative max-w-4xl max-h-full p-4">
            <img id="lightboxImg" class="max-w-full max-h-full object-contain">
            <button onclick="closeLightbox()" class="absolute top-4 right-4 text-white text-3xl hover:text-brand-red">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Success Notice -->
    <div id="successNotice" class="fixed bottom-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-lg max-w-sm hidden">
        <div class="flex items-start">
            <i class="fas fa-check-circle text-xl ml-3 mt-1"></i>
            <div>
                <h4 class="font-bold mb-2">🎉 قاعدة البيانات متصلة!</h4>
                <p class="text-sm mb-3">جميع التعديلات ستظهر لكل الزوار فوراً!</p>
                <button onclick="hideSuccessNotice()" class="bg-white text-green-500 px-3 py-1 rounded text-sm">رائع!</button>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://uspxswigpccxmgujpdpg.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVzcHhzd2lncGNjeG1ndWpwZHBnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0MjcxODYsImV4cCI6MjA3MjAwMzE4Nn0.I3hFirAEgcU7L4HGTfTP4h1cCEQFMHT7wDi-1-5AKtY';
        
        // Initialize Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Database Manager Class
        class SupabaseDB {
            constructor() {
                this.isSupabaseReady = false;
                this.initializeSupabase();
            }

            async initializeSupabase() {
                try {
                    if (SUPABASE_URL !== 'https://your-project.supabase.co') {
                        const { data, error } = await supabase
                            .from('portfolio')
                            .select('count', { count: 'exact', head: true });
                        
                        if (!error) {
                            this.isSupabaseReady = true;
                            console.log('✅ Supabase connected successfully!');
                            document.getElementById('successNotice').classList.remove('hidden');
                            await this.initializeDefaultData();
                        } else {
                            throw error;
                        }
                    } else {
                        throw new Error('Supabase not configured');
                    }
                } catch (error) {
                    console.warn('⚠️ Supabase connection failed, using demo mode:', error);
                    this.initializeDemoMode();
                }
            }

            initializeDemoMode() {
                this.isSupabaseReady = false;
                if (!localStorage.getItem('photographerDB')) {
                    const demoData = {
                        portfolio: [
                            {
                                id: '1',
                                title: "حفل زفاف رائع",
                                category: "wedding",
                                description: "لحظات جميلة من حفل زفاف مميز",
                                image_url: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iI2Y3ZmFmYyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IiM0YTVjNmEiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7Ysdin2YXZhCDYstmB2KfZgTwvdGV4dD48L3N2Zz4=",
                                likes_count: 0,
                                created_at: new Date().toISOString()
                            }
                        ],
                        comments: [],
                        services: [],
                        articles: [],
                        about: "",
                        settings: {},
                        messages: [],
                        admin: {
                            username: "admin",
                            password: "123456"
                        }
                    };
                    localStorage.setItem('photographerDB', JSON.stringify(demoData));
                }
            }

            // Portfolio methods
            async getPortfolio() {
                if (!this.isSupabaseReady) {
                    const data = JSON.parse(localStorage.getItem('photographerDB') || '{}');
                    return data.portfolio || [];
                }

                try {
                    const { data, error } = await supabase
                        .from('portfolio')
                        .select('*')
                        .order('created_at', { ascending: false });

                    if (error) throw error;
                    return data || [];
                } catch (error) {
                    console.error('Error getting portfolio:', error);
                    return [];
                }
            }

            async addPortfolioItem(item) {
                if (!this.isSupabaseReady) {
                    const data = JSON.parse(localStorage.getItem('photographerDB') || '{}');
                    item.id = Date.now().toString();
                    item.likes_count = 0;
                    item.created_at = new Date().toISOString();
                    data.portfolio = data.portfolio || [];
                    data.portfolio.push(item);
                    localStorage.setItem('photographerDB', JSON.stringify(data));
                    return item;
                }

                try {
                    const { data, error } = await supabase
                        .from('portfolio')
                        .insert([item])
                        .select();

                    if (error) throw error;
                    return data[0];
                } catch (error) {
                    console.error('Error adding portfolio item:', error);
                    throw error;
                }
            }

            async updatePortfolioItem(id, updatedItem) {
                if (!this.isSupabaseReady) {
                    const data = JSON.parse(localStorage.getItem('photographerDB') || '{}');
                    const index = data.portfolio.findIndex(item => item.id === id);
                    if (index !== -1) {
                        data.portfolio[index] = { ...data.portfolio[index], ...updatedItem };
                        localStorage.setItem('photographerDB', JSON.stringify(data));
                    }
                    return;
                }

                try {
                    const { error } = await supabase
                        .from('portfolio')
                        .update(updatedItem)
                        .eq('id', id);

                    if (error) throw error;
                } catch (error) {
                    console.error('Error updating portfolio item:', error);
                    throw error;
                }
            }

            async deletePortfolioItem(id) {
                if (!this.isSupabaseReady) {
                    const data = JSON.parse(localStorage.getItem('photographerDB') || '{}');
                    data.portfolio = data.portfolio.filter(item => item.id !== id);
                    localStorage.setItem('photographerDB', JSON.stringify(data));
                    return;
                }

                try {
                    const { error } = await supabase
                        .from('portfolio')
                        .delete()
                        .eq('id', id);

                    if (error) throw error;
                } catch (error) {
                    console.error('Error deleting portfolio item:', error);
                    throw error;
                }
            }

            // Comments methods
            async getComments(portfolioId = null) {
                if (!this.isSupabaseReady) {
                    const data = JSON.parse(localStorage.getItem('photographerDB') || '{}');
                    if (portfolioId) {
                        return data.comments.filter(c => c.portfolio_id == portfolioId);
                    }
                    return data.comments || [];
                }

                try {
                    let query = supabase.from('comments').select('*');
                    if (portfolioId) {
                        query = query.eq('portfolio_id', portfolioId);
                    }
                    const { data, error } = await query.order('created_at', { ascending: false });

                    if (error) throw error;
                    return data || [];
                } catch (error) {
                    console.error('Error getting comments:', error);
                    return [];
                }
            }

            async addComment(comment) {
                if (!this.isSupabaseReady) {
                    const data = JSON.parse(localStorage.getItem('photographerDB') || '{}');
                    comment.id = Date.now().toString();
                    comment.created_at = new Date().toISOString();
                    data.comments = data.comments || [];
                    data.comments.push(comment);
                    localStorage.setItem('photographerDB', JSON.stringify(data));
                    return comment;
                }

                try {
                    const { data, error } = await supabase
                        .from('comments')
                        .insert([comment])
                        .select();

                    if (error) throw error;
                    return data[0];
                } catch (error) {
                    console.error('Error adding comment:', error);
                    throw error;
                }
            }

            async deleteComment(id) {
                if (!this.isSupabaseReady) {
                    const data = JSON.parse(localStorage.getItem('photographerDB') || '{}');
                    data.comments = data.comments.filter(item => item.id !== id);
                    localStorage.setItem('photographerDB', JSON.stringify(data));
                    return;
                }

                try {
                    const { error } = await supabase
                        .from('comments')
                        .delete()
                        .eq('id', id);

                    if (error) throw error;
                } catch (error) {
                    console.error('Error deleting comment:', error);
                    throw error;
                }
            }

            // Likes methods
            async getLikes(portfolioId) {
                if (!this.isSupabaseReady) {
                    const data = JSON.parse(localStorage.getItem('photographerDB') || '{}');
                    return data.portfolio.find(p => p.id == portfolioId)?.likes_count || 0;
                }

                try {
                    const { count, error } = await supabase
                        .from('likes')
                        .select('*', { count: 'exact', head: true })
                        .eq('portfolio_id', portfolioId);

                    if (error) throw error;
                    return count || 0;
                } catch (error) {
                    console.error('Error getting likes:', error);
                    return 0;
                }
            }

            async addLike(portfolioId) {
                if (!this.isSupabaseReady) {
                    const data = JSON.parse(localStorage.getItem('photographerDB') || '{}');
                    const portfolio = data.portfolio.find(p => p.id == portfolioId);
                    if (portfolio) {
                        portfolio.likes_count = (portfolio.likes_count || 0) + 1;
                        localStorage.setItem('photographerDB', JSON.stringify(data));
                    }
                    return true;
                }

                try {
                    const { error } = await supabase
                        .from('likes')
                        .insert([{ portfolio_id: portfolioId }]);

                    if (error) throw error;
                    return true;
                } catch (error) {
                    console.error('Error adding like:', error);
                    return false;
                }
            }

            // Other methods for services, articles, etc.
            // ... (similar implementation for other tables)
        }

        // Initialize database
        const db = new SupabaseDB();
        let isAdminLoggedIn = false;

        // Authentication functions
        async function supabaseLogin(email, password) {
            try {
                const { data, error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) return false;
                return true;
            } catch (error) {
                return false;
            }
        }

        async function supabaseResetPassword(email) {
            try {
                const { error } = await supabase.auth.resetPasswordForEmail(email, {
                    redirectTo: window.location.href
                });
                if (error) throw error;
                return true;
            } catch (error) {
                throw error;
            }
        }

        // UI functions
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            if (element) element.classList.remove('hidden');
        }

        function hideLoading(elementId) {
            const element = document.getElementById(elementId);
            if (element) element.classList.add('hidden');
        }

        function showContent(elementId) {
            const element = document.getElementById(elementId);
            if (element) element.classList.remove('hidden');
        }

        function hideContent(elementId) {
            const element = document.getElementById(elementId);
            if (element) element.classList.add('hidden');
        }

        // Portfolio functions
        async function loadPortfolio() {
            try {
                showLoading('portfolioLoading');
                hideContent('portfolioGrid');
                
                const portfolio = await db.getPortfolio();
                const grid = document.getElementById('portfolioGrid');
                
                if (portfolio.length === 0) {
                    grid.innerHTML = '<div class="col-span-full text-center py-8 text-gray-600">لا توجد صور في المعرض حالياً</div>';
                } else {
                    grid.innerHTML = portfolio.map(item => `
                        <div class="gallery-item portfolio-item" data-category="${item.category}">
                            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                                <img src="${item.image_url}" alt="${item.title}" class="w-full h-64 object-cover cursor-pointer" onclick="openLightbox('${item.image_url}')">
                                <div class="p-4">
                                    <h3 class="font-bold text-lg mb-2">${item.title}</h3>
                                    <p class="text-gray-600 text-sm mb-3">${item.description}</p>
                                    <div class="flex items-center justify-between mb-3">
                                        <button onclick="addLike('${item.id}')" class="flex items-center space-x-2 space-x-reverse text-sm">
                                            <i class="far fa-heart"></i>
                                            <span>${item.likes_count || 0}</span>
                                        </button>
                                        <button onclick="shareOnWhatsApp('${item.image_url}')" class="flex items-center space-x-2 space-x-reverse text-sm text-green-600">
                                            <i class="fab fa-whatsapp"></i>
                                            <span>واتساب</span>
                                        </button>
                                        <button onclick="showCommentModal('${item.id}')" class="flex items-center space-x-2 space-x-reverse text-sm text-blue-600">
                                            <i class="far fa-comment"></i>
                                            <span>تعليق</span>
                                        </button>
                                    </div>
                                    <div class="comment-section" id="comments-${item.id}">
                                        <!-- Comments will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    // Load comments for each item
                    for (const item of portfolio) {
                        await loadCommentsForPortfolio(item.id);
                    }
                }
                
                hideLoading('portfolioLoading');
                showContent('portfolioGrid');
            } catch (error) {
                console.error('Error loading portfolio:', error);
                hideLoading('portfolioLoading');
                showContent('portfolioGrid');
                document.getElementById('portfolioGrid').innerHTML = '<div class="col-span-full text-center py-8 text-red-600">حدث خطأ في تحميل المعرض</div>';
            }
        }

        async function loadCommentsForPortfolio(portfolioId) {
            try {
                const comments = await db.getComments(portfolioId);
                const commentsContainer = document.getElementById(`comments-${portfolioId}`);
                
                if (comments.length === 0) {
                    commentsContainer.innerHTML = '<p class="text-sm text-gray-500">لا توجد تعليقات بعد</p>';
                } else {
                    commentsContainer.innerHTML = comments.map(comment => `
                        <div class="comment">
                            <div class="comment-header">
                                <span class="comment-author">${comment.name}</span>
                                <span class="comment-date">${new Date(comment.created_at).toLocaleDateString('ar-SA')}</span>
                            </div>
                            <p class="text-gray-700">${comment.comment}</p>
                            <div class="comment-actions mt-2">
                                <button onclick="addCommentLike('${comment.id}')" class="like-button">
                                    <i class="far fa-heart"></i>
                                    <span>${comment.likes_count || 0}</span>
                                </button>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading comments:', error);
            }
        }

        function addLike(portfolioId) {
            db.addLike(portfolioId).then(() => {
                loadPortfolio(); // Refresh to update like count
            });
        }

        function shareOnWhatsApp(imageUrl) {
            const text = "شاهد هذه الصورة الرائعة من معرض جميل غانم للتصوير";
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text + ' ' + imageUrl)}`;
            window.open(whatsappUrl, '_blank');
        }

        function showCommentModal(portfolioId) {
            document.getElementById('commentModal').dataset.portfolioId = portfolioId;
            document.getElementById('commentModal').classList.remove('hidden');
        }

        // Admin functions
        function showAdminLogin() {
            document.getElementById('adminLoginModal').classList.remove('hidden');
        }

        function hideAdminLogin() {
            document.getElementById('adminLoginModal').classList.add('hidden');
        }

        function showResetPasswordModal() {
            document.getElementById('resetPasswordModal').classList.remove('hidden');
        }

        function hideResetPasswordModal() {
            document.getElementById('resetPasswordModal').classList.add('hidden');
        }

        function showAdminPanel() {
            document.getElementById('adminPanel').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function hideAdminPanel() {
            document.getElementById('adminPanel').classList.add('hidden');
            document.body.style.overflow = 'auto';
            isAdminLoggedIn = false;
        }

        function showAdminSection(section) {
            document.querySelectorAll('.admin-section').forEach(sec => sec.classList.add('hidden'));
            document.querySelectorAll('.admin-nav-btn').forEach(btn => {
                btn.classList.remove('bg-brand-red');
                btn.classList.add('bg-gray-600');
            });
            
            document.getElementById('admin' + section.charAt(0).toUpperCase() + section.slice(1)).classList.remove('hidden');
            event.target.classList.remove('bg-gray-600');
            event.target.classList.add('bg-brand-red');
            
            // Load section content
            if (section === 'portfolio') loadAdminPortfolio();
            if (section === 'comments') loadAdminComments();
        }

        async function loadAdminComments() {
            try {
                const comments = await db.getComments();
                const list = document.getElementById('adminCommentsList');
                
                if (comments.length === 0) {
                    list.innerHTML = '<p class="text-gray-400">لا توجد تعليقات</p>';
                } else {
                    list.innerHTML = comments.map(comment => `
                        <div class="bg-gray-600 p-4 rounded-lg mb-4">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="text-white font-bold">${comment.name}</h4>
                                <button onclick="deleteComment('${comment.id}')" class="text-red-400 hover:text-red-300">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <p class="text-gray-300 text-sm mb-2">${comment.email}</p>
                            <p class="text-gray-200">${comment.comment}</p>
                            <p class="text-gray-400 text-xs mt-2">${new Date(comment.created_at).toLocaleString('ar-SA')}</p>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading admin comments:', error);
            }
        }

        // Event listeners
        document.getElementById('adminLoginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            try {
                const loginText = document.getElementById('loginText');
                const loginLoading = document.getElementById('loginLoading');
                
                loginText.classList.add('hidden');
                loginLoading.classList.remove('hidden');
                
                const email = document.getElementById('adminUsername').value;
                const password = document.getElementById('adminPassword').value;
                
                if (!email || !password) {
                    alert('يرجى إدخال البريد الإلكتروني وكلمة المرور');
                    loginText.classList.remove('hidden');
                    loginLoading.classList.add('hidden');
                    return;
                }
                
                const isValid = await supabaseLogin(email, password);
                if (isValid) {
                    isAdminLoggedIn = true;
                    hideAdminLogin();
                    showAdminPanel();
                    alert('🎉 مرحباً جميل! تم تسجيل الدخول بأمان.');
                } else {
                    alert('❌ بيانات خاطئة');
                }
                
                loginText.classList.remove('hidden');
                loginLoading.classList.add('hidden');
            } catch (error) {
                console.error('Error during login:', error);
                alert('حدث خطأ أثناء تسجيل الدخول');
            }
        });

        document.getElementById('resetPasswordForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            try {
                const email = document.getElementById('resetEmail').value;
                if (!email) return alert('يرجى إدخال البريد الإلكتروني');
                
                await supabaseResetPassword(email);
                alert('تم إرسال رابط إعادة تعيين كلمة المرور إلى بريدك الإلكتروني.');
                hideResetPasswordModal();
            } catch (error) {
                alert('حدث خطأ: ' + error.message);
            }
        });

        document.getElementById('commentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            try {
                const portfolioId = document.getElementById('commentModal').dataset.portfolioId;
                const comment = {
                    name: document.getElementById('commentName').value,
                    email: document.getElementById('commentEmail').value,
                    comment: document.getElementById('commentText').value,
                    portfolio_id: portfolioId
                };
                
                await db.addComment(comment);
                await loadCommentsForPortfolio(portfolioId);
                document.getElementById('commentModal').classList.add('hidden');
                this.reset();
                alert('تم إضافة التعليق بنجاح!');
            } catch (error) {
                console.error('Error adding comment:', error);
                alert('حدث خطأ في إضافة التعليق');
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            await loadPortfolio();
            await loadServices();
            await loadAbout();
            await loadArticles();
            await loadSettings();
        });

        // Hide success notice after 8 seconds
        setTimeout(() => {
            const notice = document.getElementById('successNotice');
            if (notice && db.isSupabaseReady) {
                notice.style.display = 'none';
            }
        }, 8000);
    </script>
</body>
</html>
